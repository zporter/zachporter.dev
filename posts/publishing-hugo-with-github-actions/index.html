<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Publishing a Hugo Site to GitHub Pages via GitHub Actions :: Zach Porter: Software Engineer</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="As of this writing, I am currently using the Hugo static site generator for this site and publishing to GitHub pages. The code is open-source on GitHub. To organize the code, I like to keep the Hugo source files in the master branch and publish from the gh-pages branch. To publish the site, I use a script that I can run locally, but I wanted to check out the relatively new GitHub Actions to see if I could automate the process after a push to the master branch."/>
<meta name="keywords" content="programmer, software engineer, developer"/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://zachporter.dev/posts/publishing-hugo-with-github-actions/" />





<link rel="stylesheet" href="https://zachporter.dev/assets/style.css">


<link rel="stylesheet" href="https://zachporter.dev/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://zachporter.dev/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="https://zachporter.dev/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Publishing a Hugo Site to GitHub Pages via GitHub Actions"/>
<meta name="twitter:description" content="As of this writing, I am currently using the Hugo static site generator for this site and publishing to GitHub pages. The code is open-source on GitHub. To organize the code, I like to keep the Hugo source files in the master branch and publish from the gh-pages branch. To publish the site, I use a script that I can run locally, but I wanted to check out the relatively new GitHub Actions to see if I could automate the process after a push to the master branch."/>



<meta property="og:title" content="Publishing a Hugo Site to GitHub Pages via GitHub Actions" />
<meta property="og:description" content="As of this writing, I am currently using the Hugo static site generator for this site and publishing to GitHub pages. The code is open-source on GitHub. To organize the code, I like to keep the Hugo source files in the master branch and publish from the gh-pages branch. To publish the site, I use a script that I can run locally, but I wanted to check out the relatively new GitHub Actions to see if I could automate the process after a push to the master branch." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zachporter.dev/posts/publishing-hugo-with-github-actions/" />
<meta property="article:published_time" content="2020-03-03T12:00:00-05:00" />
<meta property="article:modified_time" content="2020-03-03T12:00:00-05:00" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">zachporter.dev</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title"><a href="https://zachporter.dev/posts/publishing-hugo-with-github-actions/">Publishing a Hugo Site to GitHub Pages via GitHub Actions</a></h1>
    <div class="post-meta">
      
        <span class="post-date">
          2020-03-03
        </span>

        
          
        
      

      
      
        <span class="post-read-time">‚Äî 7 min read</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="https://zachporter.dev/tags/hugo/">hugo</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      
      <p>As of this writing, I am currently using the <a href="https://gohugo.io/">Hugo</a> static site generator for this site and publishing to <a href="https://pages.github.com/">GitHub pages</a>. <a href="https://github.com/zporter/zachporter.dev/">The code</a> is open-source on GitHub. To organize the code, I like to keep the Hugo source files in the <code>master</code> branch and publish from the <a href="https://github.com/zporter/zachporter.dev/tree/gh-pages"><code>gh-pages</code> branch</a>. To publish the site, I use a script that I can run locally, but I wanted to check out the relatively new <a href="https://github.com/features/actions">GitHub Actions</a> to see if I could automate the process after a push to the <code>master</code> branch. This article will cover the journey to GitHub Actions along with my takeaways.</p>
<h2 id="setup">Setup</h2>
<p>Getting started with GitHub Actions is pretty straightforward. GitHub provides a great starter template and has some examples in their documentation. There&rsquo;s also <a href="https://github.com/marketplace?type=actions">a marketplace</a> for actions to use or, in my case, use as inspiration to write my own. One downside to the marketplace is that there seems to be quite a bit of legacy code that I can only assume used earlier versions of GitHub Actions. As far as I can tell, GitHub has since changed to using a YAML-formatted file and have changed how variables can be exposed to the workspace as environment variables. The source code of the actions in the Marketplace is pretty easy to read, so you can make a judgement call as to whether you can pull it in or whether you need to roll your own.</p>
<h2 id="implementation">Implementation</h2>
<p>I started with a workflow titled &ldquo;Hugo Build and Release&rdquo; with the configuration and steps stored in <code>.github/workflows/hugo_build_and_release.yml</code>. The first line in the file is the name of the workflow.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">name</span>: Hugo Build and Release
</code></pre></div><p>Simple enough. The next section in the workflow deals with the events that need to happen on GitHub in order to trigger the Action to run.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">on</span>:
  <span style="color:#66d9ef">push</span>:
    <span style="color:#66d9ef">branches</span>:
    - master
</code></pre></div><p>I knew I wanted to trigger the publish action on push to <code>master</code>, so this is the configuration that I chose. You can review <a href="https://help.github.com/en/articles/workflow-syntax-for-github-actions#on">the documentation</a> for more actions to use to trigger the workflow.</p>
<p>Next up in the file is the <code>jobs</code> specification.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">jobs</span>:
  <span style="color:#66d9ef">deploy</span>:
    <span style="color:#66d9ef">runs-on</span>: ubuntu-latest
</code></pre></div><p>Here, I only have one job titled <code>deploy</code>. This is because by default <code>jobs</code> run in parallel. My workflow is very sequential:</p>
<ol>
<li>Checkout the source code</li>
<li>Build the Hugo site</li>
<li>Push the static site to the <code>gh-pages</code> branch</li>
</ol>
<p>It made sense to only define one job to execute a sequence of steps that are dependent on each other. If you have a workflow that can easily run in parallel, then I encourage you to consult <a href="https://help.github.com/en/articles/workflow-syntax-for-github-actions#jobs">the documentation</a> on how best to configure.</p>
<p>I chose to run my job on the <code>ubuntu-latest</code> virtual environment, since that&rsquo;s the one I&rsquo;m most familiar with. GitHub supports a number of other <a href="https://help.github.com/en/articles/virtual-environments-for-github-actions#supported-virtual-environments-and-hardware-resources">virtual environments</a>. Choose the one that best fits your workflow.</p>
<p>Now that I have a job, I need to define some steps.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">steps</span>:
- <span style="color:#66d9ef">uses</span>: actions/checkout@v1
</code></pre></div><p>GitHub gave me a <code>checkout</code> action as part of the starter template. This will checkout the source code in the <code>master</code> branch and store it in a workspace on the virtual environment.</p>
<h2 id="problems-with-checkout">Problems with Checkout</h2>
<p>At the time, I had two <a href="https://github.com/blog/2104-working-with-submodules">git submodules</a> in the project: one for <a href="https://github.com/zporter/hugo-theme-hello-friend">the theme</a> and one for the <code>public</code> directory, which was pointed to the <code>gh-pages</code> branch for publishing the GitHub Pages site. I&rsquo;ve since moved away from the second submodule and followed <a href="https://gohugo.io/hosting-and-deployment/hosting-on-github/#deployment-of-project-pages-from-your-gh-pages-branch">Hugo&rsquo;s documentation</a> on deploying from the <code>master</code> branch to the remote <code>gh-pages</code> branch on GitHub. To pull in the git submodule for the theme, I had to add a simple option to allow checking out submodules:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#66d9ef">uses</span>: actions/checkout@v1
  <span style="color:#66d9ef">with</span>:
    <span style="color:#66d9ef">submodules</span>: <span style="color:#66d9ef">true</span>
</code></pre></div><p>Running the action so far resulted in a success, so now it was time to move onto building the static site.</p>
<h2 id="installing-hugo">Installing Hugo</h2>
<p>I knew I would need Hugo in order to build the static site. It was just a matter of determining the best way to install the dependency. After reviewing several existing Actions in the Marketplace, I settled on adding the following step to my job:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#66d9ef">name</span>: Install Dependencies
  <span style="color:#66d9ef">env</span>:
    <span style="color:#66d9ef">HUGO_VERSION</span>: <span style="color:#ae81ff">0.58.3</span>
  <span style="color:#66d9ef">run</span>: <span style="color:#e6db74">|
</span><span style="color:#e6db74">    echo &#34;installing hugo $HUGO_VERSION&#34;</span>
    curl -sL -o /tmp/hugo.deb \
    https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_extended_${HUGO_VERSION}_Linux-64bit.deb <span style="color:#75715e">&amp;&amp;</span> \
    sudo dpkg -i /tmp/hugo.deb <span style="color:#75715e">&amp;&amp;</span> \
    rm /tmp/hugo.deb
</code></pre></div><p>Since this is in an Ubuntu container, <a href="https://gohugo.io/getting-started/installing/#install-hugo-from-tarball">the Hugo Debian package</a> can be downloaded with the version of Hugo I need.</p>
<p>With the Hugo dependency installed, it&rsquo;s now time to publish the site.</p>
<h2 id="publishing">Publishing</h2>
<p>I could have placed the publishing commands in the Actions workflow file, but I had already been using a script to publish the site, and I would like to maintain the ability to publish outside of the GitHub Action. I had to make some modifications to my previous publishing workflow, but I think the final version ended up a bit cleaner:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># ./bin/publish.sh</span>

<span style="color:#75715e">#!/bin/sh</span>

<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;`git status -s`&#34;</span> <span style="color:#f92672">]</span>
<span style="color:#66d9ef">then</span>
    echo <span style="color:#e6db74">&#34;The working directory is dirty. Please commit any pending changes.&#34;</span>
    exit 1;
<span style="color:#66d9ef">fi</span>

echo <span style="color:#e6db74">&#34;Deleting old publication&#34;</span>
rm -rf public
mkdir public
git worktree prune
rm -rf .git/worktrees/public/

echo <span style="color:#e6db74">&#34;Checking out gh-pages branch into public&#34;</span>
git worktree add -B gh-pages public origin/gh-pages

echo <span style="color:#e6db74">&#34;Removing existing files&#34;</span>
rm -rf public/*

echo <span style="color:#e6db74">&#34;Generating site&#34;</span>
hugo

echo <span style="color:#e6db74">&#34;Updating gh-pages branch&#34;</span>
cd public <span style="color:#f92672">&amp;&amp;</span> git add --all <span style="color:#f92672">&amp;&amp;</span> git commit -m <span style="color:#e6db74">&#34;Publishing to gh-pages (publish.sh)&#34;</span>

echo <span style="color:#e6db74">&#34;Pushing to github&#34;</span>
git push -f <span style="color:#e6db74">${</span>REPOSITORY<span style="color:#66d9ef">:-</span>origin<span style="color:#e6db74">}</span> gh-pages
</code></pre></div><p>Each of the <code>echo</code> commands above should make it pretty clear what is happening. The script is leveraging <a href="https://git-scm.com/docs/git-worktree/">Git worktrees</a>, which comes in handy when committing and pushing work in another directory to a remote branch. In this case, the site code gets generated into the <code>public/</code> directory, and the changes are committed and pushed up to the remote <code>gh-pages</code> branch. GitHub takes over from there to post the content here.</p>
<p>To publish from my computer, I now only need to specify the <code>REPOSITORY</code> environment variable, and I&rsquo;m up and running.</p>
<p>To run this from the GitHub Action, I just add the following to my <code>hugo_build_and_release.yml</code> specification:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#66d9ef">name</span>: Publish Site
  <span style="color:#66d9ef">env</span>:
    <span style="color:#66d9ef">REPOSITORY</span>: <span style="color:#e6db74">&#34;https://${{ secrets.GITHUB_PAT }}@github.com/${{ github.repository }}.git&#34;</span>
  <span style="color:#66d9ef">run</span>: ./bin/publish.sh
</code></pre></div><p>This uses <a href="https://github.blog/2013-05-16-personal-api-tokens/">a Personal Access Token</a>, which, at the time of this writing, was required in order to effectively trigger the GitHub Pages publish action. That may be fixed in the future for <a href="https://help.github.com/en/actions/automating-your-workflow-with-github-actions/authenticating-with-the-github_token#using-the-github_token-in-a-workflow">the already provided access token</a> within the GitHub Action. I gave my Personal Access Token <code>repo</code> and <code>admin:repo_hook</code> privileges. This might&rsquo;ve been overkill, but it was very difficult to dig up information on what exactly was required to trigger a GitHub Pages publication. Once that Personal Access Token was generated, I stored it as a Secret on the repository and referenced it as <code>secrets.GITHUB_PAT</code>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>That concludes the approach that I took to use GitHub Actions to publish my site built using the Hugo static site generator on GitHub Pages. The process was a lot of trial and error. Being early days for GitHub Actions, the documentation was difficult to search and sift through, and having no feedback that my site was failing to build on GitHub Pages after a push was difficult to debug and fix. I ended up reading what others had done on the Actions Marketplace, so kudos to those trailblazers for leaving comments as to why they needed to use a Personal Access Token.</p>
<p>The final workflow file ended up like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#66d9ef">name</span>: Hugo Build and Release

<span style="color:#66d9ef">on</span>:
  <span style="color:#66d9ef">push</span>:
    <span style="color:#66d9ef">branches</span>:
    - master

<span style="color:#66d9ef">jobs</span>:
  <span style="color:#66d9ef">deploy</span>:

    <span style="color:#66d9ef">runs-on</span>: ubuntu-latest
    
    <span style="color:#66d9ef">steps</span>:
    - <span style="color:#66d9ef">name</span>: Configure Git for Github
      <span style="color:#66d9ef">run</span>: <span style="color:#e6db74">|
</span><span style="color:#e6db74">        git config --global user.name &#34;${GITHUB_ACTOR}&#34;</span>
        git config --global user.email <span style="color:#e6db74">&#34;${GITHUB_ACTOR}@users.noreply.github.com&#34;</span>
    - <span style="color:#66d9ef">uses</span>: actions/checkout@v1
      <span style="color:#66d9ef">with</span>:
        <span style="color:#66d9ef">submodules</span>: <span style="color:#66d9ef">true</span>
    - <span style="color:#66d9ef">name</span>: Install Dependencies
      <span style="color:#66d9ef">env</span>:
        <span style="color:#66d9ef">HUGO_VERSION</span>: <span style="color:#ae81ff">0.58.3</span>
      <span style="color:#66d9ef">run</span>: <span style="color:#e6db74">|
</span><span style="color:#e6db74">        echo &#34;installing hugo $HUGO_VERSION&#34;</span>
        curl -sL -o /tmp/hugo.deb \
        https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_extended_${HUGO_VERSION}_Linux-64bit.deb <span style="color:#75715e">&amp;&amp;</span> \
        sudo dpkg -i /tmp/hugo.deb <span style="color:#75715e">&amp;&amp;</span> \
        rm /tmp/hugo.deb
    - <span style="color:#66d9ef">name</span>: Publish Site
      <span style="color:#66d9ef">env</span>:
        <span style="color:#66d9ef">REPOSITORY</span>: <span style="color:#e6db74">&#34;https://${{ secrets.GITHUB_PAT }}@github.com/${{ github.repository }}.git&#34;</span>
      <span style="color:#66d9ef">run</span>: ./bin/publish.sh
</code></pre></div><p>Overall, I am thankful that this is available to me so I can push changes to the <code>master</code> branch and not need to remember a separate publishing step. I just hope that GitHub can continue to improve the documentation and provide feedback when services fail. I encourage you, dear reader, to find ways to automate your workflows with GitHub Actions. Write up your experiences and share back with the community. üíú</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://zachporter.dev/posts/lets-code-contact-form-in-phoenix-part-one/">
                  <span class="button__icon">‚Üê</span>
                  <span class="button__text">Let&#39;s Code: Contact Form in Phoenix -- The Schema</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="https://zachporter.dev/posts/writing-an-api-wrapper-in-elixir-with-httpoison/">
                  <span class="button__text">Writing an API Wrapper in Elixir With HTTPoison</span>
                  <span class="button__icon">‚Üí</span>
                </a>
              </span>
            
          </div>
        </div>
      
    


    
      
        

      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">zachporter.dev</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span>¬© 2020</span>

        <div class="social-links">
          
  <span class="social-link">
    <a href="https://github.com/zporter" target="_blank">
      <i class="fab fa-github-square"></i>
    </a>
  </span>



          
  <span class="social-link">
    <a href="https://twitter.com/zporter9" target="_blank">
      <i class="fab fa-twitter-square"></i>
    </a>
  </span>



          
  <span class="social-link">
    <a href="https://www.linkedin.com/in/zach-porter-5058b0181" target="_blank">
      <i class="fab fa-linkedin"></i>
    </a>
  </span>



          
  <span class="social-link">
    <a href="mailto:zporter9@gmail.com" target="_blank">
      <i class="fas fa-envelope-square"></i>
    </a>
  </span>


        </div>
      </div>
    
  </div>
</footer>

<script src="https://zachporter.dev/assets/main.js"></script>
<script src="https://zachporter.dev/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
